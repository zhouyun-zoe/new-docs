<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.54">
<link rel="alternate" type="application/rss+xml" href="/new-docs/blog/rss.xml" title="Muta Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/new-docs/blog/atom.xml" title="Muta Blog Atom Feed">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu|Roboto|Source+Code+Pro">
<link rel="stylesheet" href="https://at-ui.github.io/feather-font/css/iconfont.css">

<title data-react-helmet="true">Structuring Your Log Data | Muta</title>

<meta data-react-helmet="true" property="og:title" content="Structuring Your Log Data | Muta"><meta data-react-helmet="true" name="description" content="Structuring Your Log Data, in minutes, for free"><meta data-react-helmet="true" property="og:description" content="Structuring Your Log Data, in minutes, for free"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image">

<link data-react-helmet="true" rel="shortcut icon" href="/new-docs/img/muta-logo.png">


<link rel="stylesheet" href="/new-docs/styles.62a44f3a.css">


<link rel="preload" href="/new-docs/styles.abbfd07e.js" as="script">

<link rel="preload" href="/new-docs/runtime~main.627e1464.js" as="script">

<link rel="preload" href="/new-docs/main.6e8035f4.js" as="script">

<link rel="preload" href="/new-docs/1.6fb1deea.js" as="script">

<link rel="preload" href="/new-docs/2.3e1e1c9b.js" as="script">

<link rel="preload" href="/new-docs/3.227db9a3.js" as="script">

<link rel="preload" href="/new-docs/1c13b173.acdf7bc3.js" as="script">

<link rel="preload" href="/new-docs/4.d1a1e1b5.js" as="script">

<link rel="preload" href="/new-docs/20bfc86b.ffaf7732.js" as="script">

</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script>
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top navbarHideable_OaSq"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/new-docs/"><img class="navbar__logo" src="/new-docs/img/muta.svg" alt="muta"></a><a class="navbar__item navbar__link" href="/new-docs/docs/">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/new-docs/guides/">Guides</a><a class="navbar__item navbar__link" href="/new-docs/blog/">Blog</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/new-docs/community/">community</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a activeclassname="navbar__link--active" class="navbar__item navbar__link">Translation</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/new-docs/docs-zh/what-is-muta">中文</a></li><li><a class="dropdown__link" href="/new-docs/docs/about/what-is-muta">English</a></li></ul></div><a target="_blank" rel="noopener noreferrer" href="https://github.com/nervosnetwork/muta" class="navbar__item navbar__link header-github-link"></a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_34Mc moon_313u"></span></div><div class="react-toggle-track-x"><span class="toggle_34Mc sun_1Og-"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input search-bar"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/new-docs/"><img class="navbar__logo" src="/new-docs/img/muta.svg" alt="muta"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" position="left" href="/new-docs/docs/">Docs</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" position="left" href="/new-docs/guides/">Guides</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/new-docs/blog/">Blog</a></li><li class="menu__list-item"><a class="menu__link" position="right" href="/new-docs/community/">community</a></li><li class="menu__list-item"><a activeclassname="navbar__link--active" class="menu__link menu__link--sublist" position="right">Translation</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/new-docs/docs-zh/what-is-muta">中文</a></li><li class="menu__list-item"><a class="menu__link" href="/new-docs/docs/about/what-is-muta">English</a></li></ul></li><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" href="https://github.com/nervosnetwork/muta" class="menu__link header-github-link" position="right"></a></li></ul></div></div></div></nav><div class="main-wrapper"><header class="hero domain-bg domain-bg--config"><div class="container"><div class="hero--category"><a href="/new-docs/guides/getting-started/">getting-started</a></div><h1 class="header_1mJE">Structuring Your Log Data</h1><div class="hero--subtitle">How to parse log data in Vector</div><span class="tags_3AF9"><a class="badge badge--rounded badge--blue" href="/new-docs/guides/tags/type-tutorial/">type: tutorial</a><a class="badge badge--rounded badge--primary" href="/new-docs/guides/tags/domain-config/">domain: config</a></span></div></header><main class="container container--l container_1ncB"><aside class="sidebar_1pU0"><section class="avatar_1sJg"><div class="avatar avatar--lg avatar--vertical"><img class="avatar__photo avatar__photo--lg" src="https://github.com/zhouyun-zoe.png"><div class="avatar__intro"><div class="avatar__name"><a href="https://github.com/zhouyun-zoe" target="_blank" rel="author">zhouyun-zoe</a></div><small class="avatar__subtitle">Zhouyun is the professional char of Muta. Love everything expect programming.</small></div></div></section><section class="table-of-contents tableOfContents_1eMQ"><div class="section"><div class="title">Stats</div><div class="text--secondary text--bold"><i class="feather icon-book"></i> 6 min read</div><div class="text--secondary text--bold"><i class="feather icon-clock"></i> Updated <time pubdate="pubdate" datetime="2020-07-13">Jul 13th, 2020</time></div></div><div class="section"><div class="title">Contents</div><ul class="contents"><li><a href="#overview" class="contents__link">Overview</a></li><li><a href="#tutorial" class="contents__link">Tutorial</a><ul><li><a href="#setup-a-basic-pipeline" class="contents__link">Setup a basic pipeline</a></li><li><a href="#add-a-parsing-transform" class="contents__link">Add a parsing transform</a></li><li><a href="#test-it" class="contents__link">Test it</a></li></ul></li><li><a href="#next-steps" class="contents__link">Next Steps</a></li></ul></div></section></aside><div class="article_mCV7"><article><div class="markdown"><a aria-hidden="true" tabindex="-1" class="anchor" id="overview"></a><p>Structured logs are like cocktails; they&#x27;re cool because they&#x27;re complicated.
In this guide we&#x27;ll build a pipeline using <a href="/docs/reference/transforms/">transformations</a>
that allows us to send unstructured <a href="/docs/about/data-model/">events</a> through it that
look like this:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button><pre class="prism-code language-text codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">172.128.80.109 - Bins5273 656 [2019-05-03T13:11:48-04:00] \&quot;PUT /mesh\&quot; 406 10272</span></div></div></pre></div></div><p>And have them coming out the other end in a structured format like this:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button><pre class="prism-code language-json codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;bytes_in&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;656&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;timestamp&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;2019-05-03T13:11:48-04:00&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;method&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;PUT&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;bytes_out&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;10272&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;host&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;172.128.80.109&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;status&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;406&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;user&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;Bins5273&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;path&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;/mesh&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></div></div></pre></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="tutorial"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#tutorial" title="Direct link to heading">#</a>Tutorial</h2><div class="steps steps--h3"><ol><li><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="setup-a-basic-pipeline"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#setup-a-basic-pipeline" title="Direct link to heading">#</a>Setup a basic pipeline</h3><p>In the last guide we simply piped stdin to stdout, I&#x27;m not trying to diminish
your sense of achievement but that was pretty basic.</p><p>This time we&#x27;re going to build a config we might use in the real world. It&#x27;s
going to consume logs over TCP with a <a href="/docs/reference/sources/socket/"><code>socket</code> source</a> and
write them to an <a href="/docs/reference/sinks/elasticsearch/"><code>elasticsearch</code> sink</a>.</p><div class="alert alert--info alert--icon" role="alert"><i class="feather icon-info"></i><p>There&#x27;s no need to run a local Elasticsearch for this guide as we can write and
even test our config without connecting to sources or sinks (as you&#x27;ll see).</p></div><p>The basic source to sink version of our pipeline looks like this:</p><div class="mdxCodeBlock_iHAB"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_2TQJ">vector.toml</div><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb copyButtonWithTitle_qt-P">Copy</button><pre class="prism-code language-toml codeBlock_1wn8 codeBlockWithTitle_1f_H"><div class="codeBlockLines_3HrO" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token table class-name">sources.foo</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key property" style="color:#36acaa">type</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;socket&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key property" style="color:#36acaa">address</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0.0.0.0:9000&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key property" style="color:#36acaa">mode</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;tcp&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token table class-name">sinks.bar</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key property" style="color:#36acaa">inputs</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;foo&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key property" style="color:#36acaa">type</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;elasticsearch&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key property" style="color:#36acaa">index</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;example-index&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key property" style="color:#36acaa">host</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;http://10.24.32.122:9000&quot;</span></div></div></pre></div></div><p>If we were to run it then the raw data we consume over TCP would be captured in
the field <code>message</code>, and the object we&#x27;d publish to Elasticsearch would look
like this:</p><div class="mdxCodeBlock_iHAB"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_2TQJ">log event</div><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb copyButtonWithTitle_qt-P">Copy</button><pre class="prism-code language-json codeBlock_1wn8 codeBlockWithTitle_1f_H"><div class="codeBlockLines_3HrO" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;message&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;172.128.80.109 - Bins5273 656 [2019-05-03T13:11:48-04:00] \&quot;PUT /mesh\&quot; 406 10272&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">&quot;host&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;foo&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">&quot;timestamp&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;2019-05-03T13:11:48-04:00&quot;</span><span class="token punctuation" style="color:#393A34">}</span></div></div></pre></div></div><p>That&#x27;s hardly structured at all! Let&#x27;s remedy that by adding our first transform.</p></li><li><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="add-a-parsing-transform"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#add-a-parsing-transform" title="Direct link to heading">#</a>Add a parsing transform</h3><p>Nothing in this world is ever good enough for you, why should events be any
different?</p><p>Vector makes it easy to mutate events into a more (or less) structured format
with <a href="/docs/reference/transforms/">transforms</a>. Let&#x27;s parse our logs into a structured
format by capturing named regular expression groups with a
<a href="/docs/reference/transforms/regex_parser/"><code>regex_parser</code> transform</a>.</p><p>A config can have any number of transforms and it&#x27;s entirely up to you how they
are chained together. Similar to sinks, a transform requires you to specify
where its data comes from. When a sink is configured to accept data from a
transform the pipeline is complete.</p><p>Let&#x27;s place our new transform in between our existing source and sink:</p><div class="margin-bottom--md"><div><ul role="tablist" aria-orientation="horizontal" class="tabs tabs--block"><li role="tab" tabindex="0" aria-selected="true" class="tab-item tab-item--active">Diff</li><li role="tab" tabindex="0" aria-selected="false" class="tab-item">Full Config</li></ul></div></div><div class="mdxCodeBlock_iHAB"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_2TQJ">vector.toml</div><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb copyButtonWithTitle_qt-P">Copy</button><pre class="prism-code language-diff codeBlock_1wn8 codeBlockWithTitle_1f_H"><div class="codeBlockLines_3HrO" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">[sources.foo]</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token unchanged">   type = &quot;socket&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token unchanged">   address = &quot;0.0.0.0:9000&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token unchanged">   mode = &quot;tcp&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token unchanged"></span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token inserted-sign inserted" style="color:#36acaa">+[transforms.apache_parser]</span></div><div class="token-line" style="color:#393A34"><span class="token inserted-sign inserted" style="color:#36acaa">+  inputs = [&quot;foo&quot;]</span></div><div class="token-line" style="color:#393A34"><span class="token inserted-sign inserted" style="color:#36acaa">+  type = &quot;regex_parser&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token inserted-sign inserted" style="color:#36acaa">+  field = &quot;message&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token inserted-sign inserted" style="color:#36acaa">+  regex = &#x27;^(?P&lt;host&gt;[\w\.]+) - (?P&lt;user&gt;[\w]+) (?P&lt;bytes_in&gt;[\d]+) \[(?P&lt;timestamp&gt;.*)\] &quot;(?P&lt;mathod&gt;[\w]+) (?P&lt;path&gt;.*)&quot; (?P&lt;status&gt;[\d]+) (?P&lt;bytes_out&gt;[\d]+)$&#x27;</span></div><div class="token-line" style="color:#393A34"><span class="token inserted-sign inserted" style="color:#36acaa">+</span></div><div class="token-line" style="color:#393A34"><span class="token inserted-sign inserted" style="color:#36acaa"></span><span class="token unchanged"> [sinks.bar]</span></div><div class="token-line" style="color:#393A34"><span class="token unchanged"></span><span class="token deleted-sign deleted" style="color:#d73a49">-  inputs = [&quot;foo&quot;]</span></div><div class="token-line" style="color:#393A34"><span class="token deleted-sign deleted" style="color:#d73a49"></span><span class="token inserted-sign inserted" style="color:#36acaa">+  inputs = [&quot;apache_parser&quot;]</span></div><div class="token-line" style="color:#393A34"><span class="token inserted-sign inserted" style="color:#36acaa"></span><span class="token unchanged">   type = &quot;elasticsearch&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token unchanged">   index = &quot;example-index&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token unchanged">   host = &quot;http://10.24.32.122:9000&quot;</span></div></div></pre></div></div><p>This regular expression looks great and it probably works, but it&#x27;s best to be
sure, right? Which leads us onto the next step.</p></li><li><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="test-it"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#test-it" title="Direct link to heading">#</a>Test it</h3><p>No one is saying that unplanned explosions aren&#x27;t cool, but you should be doing
that in your own time. In order to test our transform we <em>could</em> set up a local
Elasticsearch instance and run the whole pipeline, but that&#x27;s an awful bother
and Vector has a much better way.</p><p>Instead, we can write <a href="/guides/advanced/unit-testing/">unit tests</a> as part of our
config just like you would for regular code:</p><div class="margin-bottom--md"><div><ul role="tablist" aria-orientation="horizontal" class="tabs tabs--block"><li role="tab" tabindex="0" aria-selected="true" class="tab-item tab-item--active">Diff</li><li role="tab" tabindex="0" aria-selected="false" class="tab-item">Full Config</li></ul></div></div><div class="mdxCodeBlock_iHAB"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_2TQJ">vector.toml</div><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb copyButtonWithTitle_qt-P">Copy</button><pre class="prism-code language-diff codeBlock_1wn8 codeBlockWithTitle_1f_H"><div class="codeBlockLines_3HrO" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain"># Write the data</span></div><div class="token-line" style="color:#393A34"><span class="token plain">[sinks.bar]</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token unchanged">  inputs = [&quot;apache_parser&quot;]</span></div><div class="token-line" style="color:#393A34"><span class="token unchanged">  type = &quot;elasticsearch&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token unchanged">  index = &quot;example-index&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token unchanged">  host = &quot;http://10.24.32.122:9000&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token unchanged"></span><span class="token inserted-sign inserted" style="color:#36acaa">+</span></div><div class="token-line" style="color:#393A34"><span class="token inserted-sign inserted" style="color:#36acaa">+[[tests]]</span></div><div class="token-line" style="color:#393A34"><span class="token inserted-sign inserted" style="color:#36acaa">+  name = &quot;test apache regex&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token inserted-sign inserted" style="color:#36acaa">+</span></div><div class="token-line" style="color:#393A34"><span class="token inserted-sign inserted" style="color:#36acaa">+  [[tests.inputs]]</span></div><div class="token-line" style="color:#393A34"><span class="token inserted-sign inserted" style="color:#36acaa">+    insert_at = &quot;apache_parser&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token inserted-sign inserted" style="color:#36acaa">+    type = &quot;raw&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token inserted-sign inserted" style="color:#36acaa">+    value = &quot;172.128.80.109 - Bins5273 656 [2019-05-03T13:11:48-04:00] \&quot;PUT /mesh\&quot; 406 10272&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token inserted-sign inserted" style="color:#36acaa">+</span></div><div class="token-line" style="color:#393A34"><span class="token inserted-sign inserted" style="color:#36acaa">+  [[tests.outputs]]</span></div><div class="token-line" style="color:#393A34"><span class="token inserted-sign inserted" style="color:#36acaa">+    extract_from = &quot;apache_parser&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token inserted-sign inserted" style="color:#36acaa">+    [[tests.outputs.conditions]]</span></div><div class="token-line" style="color:#393A34"><span class="token inserted-sign inserted" style="color:#36acaa">+      type = &quot;check_fields&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token inserted-sign inserted" style="color:#36acaa">+      &quot;method.eq&quot; = &quot;PUT&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token inserted-sign inserted" style="color:#36acaa">+      &quot;host.eq&quot; = &quot;172.128.80.109&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token inserted-sign inserted" style="color:#36acaa">+      &quot;timestamp.eq&quot; = &quot;2019-05-03T13:11:48-04:00&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token inserted-sign inserted" style="color:#36acaa">+      &quot;path.eq&quot; = &quot;/mesh&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token inserted-sign inserted" style="color:#36acaa">+      &quot;status.eq&quot; = &quot;406&quot;</span></div></div></pre></div></div><p>This unit test spec has a name, defines an input event to feed into our pipeline
at a specific transform (in this case our <em>only</em> transform), and defines where
we&#x27;d like to capture resulting events coming out along with a condition to check
the events against.</p><p>When we run:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button><pre class="prism-code language-bash codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">vector </span><span class="token builtin class-name">test</span><span class="token plain"> ./vector.toml</span></div></div></pre></div></div><p>It will parse and execute our test:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button><pre class="prism-code language-text codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Running vector.toml tests</span></div><div class="token-line" style="color:#393A34"><span class="token plain">test vector.toml: test apache regex ... failed</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">failures:</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">--- vector.toml ---</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">test &#x27;test apache regex&#x27;:</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">check transform &#x27;apache_parser&#x27; failed conditions:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  condition[0]: predicates failed: [ method.eq: &quot;PUT&quot; ]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">payloads (events encoded as JSON):</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  input: {&quot;timestamp&quot;:&quot;2020-02-20T10:19:27.283745Z&quot;,&quot;message&quot;:&quot;172.128.80.109 - Bins5273 656 [2019-05-03T13:11:48-04:00] \&quot;PUT /mesh\&quot; 406 10272&quot;}</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  output: {&quot;bytes_in&quot;:&quot;656&quot;,&quot;timestamp&quot;:&quot;2019-05-03T13:11:48-04:00&quot;,&quot;mathod&quot;:&quot;PUT&quot;,&quot;bytes_out&quot;:&quot;10272&quot;,&quot;host&quot;:&quot;172.128.80.109&quot;,&quot;status&quot;:&quot;406&quot;,&quot;user&quot;:&quot;Bins5273&quot;,&quot;path&quot;:&quot;/mesh&quot;}</span></div></div></pre></div></div><p>By Jove! There <em>was</em> a problem with our regular expression! Our test has pointed
out that the predicate <code>method.eq</code> failed, and has helpfully printed our input
and resulting events in JSON format.</p><p>This allows us to inspect exactly what our transform is doing, and it turns out
that the method from our Apache log is actually being captured in a field
<code>mathod</code>.</p><p>See if you can spot the typo, once it&#x27;s fixed we can run
<code>vector test ./vector.toml</code> again and we should get this:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button><pre class="prism-code language-text codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Running vector.toml tests</span></div><div class="token-line" style="color:#393A34"><span class="token plain">test vector.toml: test apache regex ... passed</span></div></div></pre></div></div><p>Success! Next, try experimenting by adding more <a href="/docs/reference/transforms/">transforms</a> to
your pipeline before moving onto the next guide.</p><div class="alert alert--info alert--icon" role="alert"><i class="feather icon-info"></i><p>While we&#x27;re at, did you know you can control all of Vector&#x27;s field names via
the <a href="/docs/reference/global-options/#log_schema">global <code>log_schema</code> options</a>?
Vector does not lock you into any specific schema.</p></div></li></ol><div class="steps--feedback">How was it? Did this tutorial work?  <span class="button button--sm button--primary">Yes</span>  <a href="https://github.com/nervosnetwork/muta/issues/new?body=The%20tutorial%20on%3A%0A%0Anull%0A%0AHere%27s%20what%20went%20wrong%3A%0A%0A%3C%21--%20Insert%20command%20output%20and%20details.%20Thank%20you%20for%20reporting%21%20%3A%29%20--%3E&amp;title=Tutorial%20on%20null%20failed" target="_blank" class="button button--sm button--primary">No</a></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="next-steps"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#next-steps" title="Direct link to heading">#</a>Next Steps</h2><p>Now that you&#x27;re a Vector pro you&#x27;ll have endless ragtag groups of misfits
trying to recruit you as their hacker, but it won&#x27;t mean much if you can&#x27;t
deploy Vector. Onto the next guide!</p></div></article><nav class="pagination-nav paginator_1WWz"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/new-docs/guides/getting-started/your-first-pipeline"><h5 class="pagination-nav__link--sublabel">Previous</h5><h4 class="pagination-nav__link--label">« Hello World. Your First Muta Blockchain.</h4></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/new-docs/guides/getting-started/deploying"><h5 class="pagination-nav__link--sublabel">Next</h5><h4 class="pagination-nav__link--label">Deploying Vector »</h4></a></div></nav></div></main></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col col--5 footer__col"><div class="margin-bottom--md"></div><div class="margin-bottom--md"><div class="mailing-list"><form action="https://dev.us17.list-manage.com/subscribe/post?u=a7b19925733ee6bf88e045485&amp;id=d8c4724e17" method="post" class="mailing-list--form"><button class="button button--primary button--undefined" type="submit">❤ Subscribe us for Muta updates ❤ </button></form></div></div><div><a href="https://twitter.com/nervosnetwork" target="_blank"><i class="feather icon-twitter" alt="Vector&#x27;s Twitter"></i></a>    <a href="https://discord.com/invite/rN35fe8" target="_blank"><i class="feather icon-message-circle" alt="Vector&#x27;s Chat"></i></a>    <a href="https://github.com/nervosnetwork/muta" target="_blank"><i class="feather icon-github" alt="Vector&#x27;s Github Repo"></i></a></div></div><div class="col footer__col"><h4 class="footer__title">About</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/new-docs/docs/about/what-is-muta/">What is Muta?</a></li><li class="footer__item"><a class="footer__link-item" href="/new-docs/community/#team">The Team</a></li><li class="footer__item"><a class="footer__link-item" href="/new-docs/contact/">Contact Us</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Development</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/new-docs/docs/setup/getting-started/">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/new-docs/docs/dev/service/">Service Dev</a></li><li class="footer__item"><a class="footer__link-item" href="/new-docs/docs/dev/dapp-dev/">Dapp Dev</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://talk.nervos.org/">Forum</a></li><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://discord.com/invite/rN35fe8">Discord</a></li><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://twitter.com/nervosnetwork">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/new-docs/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://github.com/nervosnetwork/muta">GitHub</a></li></ul></div></div><div class="text--center"><div class="margin-bottom--sm"><a href="https://nervos.org/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_3L_r"></a></div>Copyright © 2020 Nervos Fundation<br></div></div></footer>
</div>

<script src="/new-docs/styles.abbfd07e.js"></script>

<script src="/new-docs/runtime~main.627e1464.js"></script>

<script src="/new-docs/main.6e8035f4.js"></script>

<script src="/new-docs/1.6fb1deea.js"></script>

<script src="/new-docs/2.3e1e1c9b.js"></script>

<script src="/new-docs/3.227db9a3.js"></script>

<script src="/new-docs/1c13b173.acdf7bc3.js"></script>

<script src="/new-docs/4.d1a1e1b5.js"></script>

<script src="/new-docs/20bfc86b.ffaf7732.js"></script>


</body>
</html>